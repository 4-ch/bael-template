{
  "title": "Email Newsletter Setup",
  "date": "2018-07-08T02:29:06-07:00",
  "category": "Setup",
  "body": "Set up an email newsletter and accept signups with this template. You'll need an account and API key with [Sendgrid](https://www.sendgrid.com) to use this.\n\nUse the instructions below to set it up:\n\n# Lambda Sendgrid Mailing List Rest API\n\nA \"ready to deploy\" serverless mailing list subscription API endpoint using a Node.js [AWS Lambda](<>) function and the [Sendgrid](https://sendgrid.com) API. Collect emails and optionally, a welcome messages with a single `POST` HTTP request.\n\n### Prerequisites\n\n* Sendgrid Account + Sendgrid API Key\n* Create a verified sender\n* (Optional) Create a welcome email template with a\n\n## Deploy as a Netlify Function\n\nNavigate to your project's root:\n\n`$ cd <path>/<to>/<site>`\n\nDownload the function sources into the subdirectory of your choice (eg: src/mailing-api):\n\n`$ wget -P src/mailing-api https://raw.githubusercontent.com/ndethore/lambda-sendgrid-mailinglist-api/master/app.js`\n\nInstall the [netlify-lambda](https://github.com/netlify/netlify-lambda) CLI helper:\n\n`npm install -g netlify-lambda` or `yarn global add netlify-lambda`\n\nAdd a build rule to your npm scripts in `package.json`:\n\n```json\n{\t\n\t\"scripts\": {\n\t\t...\n\t\t\"build:api\": \"netlify-lambda build src/mailing-api\"\n\t\t\n\t}\n}\n```\n\nSpecify a build folder for your functions by adding a `function` field to your `netlify.toml` or on the web interface **Settings** > **Functions**. (Settings in `netlify.toml` override settings in the web interface):\n\n```toml\n[build]\n  functions = \"functions\"\n```\n\nAdd the following environment variables for the function:\n\n<img src=\"media/env_vars.png\" width=\"1272\">\n\nFinally, add `&& npm run build:api` to the build command in your projects deployment setting.\n\n<img src=\"media/build_command.png\" width=\"1272\">\n\n### Usage\n\nThe endpoint is accessible from your webapp using the relative url `/.netlify/functions/mailing-api` and accepts `POST` HTTP requests with the following payload format:\n\n```json\n{\n\t\"first_name\": \"Jhonny\",\n\t\"email\": \"jonny@appleseed.com\"\n}\n```\n\nAdd the query parameter `?welcome_email=true` to email newly added recipients using the specified Sendgrid template ID.\n\n### Local Testing\n\nCreate the following environment variables:\n\n`SENDGRID_API_KEY`(Required) `SENDGRID_WELCOME_SENDER_EMAIL` `SENDGRID_WELCOME_SENDER_NAME` `SENDGRID_WELCOME_TEMPLATE_ID`\n\nAdd a proxy rule to your webpack configuration:\n\n```json\n{\n...\n proxy: {\n      \"/.netlify\": {\n        target: \"http://localhost:9000\",\n        pathRewrite: {\"^/.netlify/functions\" : \"\"}\n      }\n}\n```\n\nRun `netlify-lambda serve mailing-api`.  \n\n## Todo\n\n* Apex.run deployment instructions\n* Serverless Framework deployment instructins\n\n## License\n\nMIT"
}